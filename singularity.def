Bootstrap: docker
From: ubuntu:24.04

%environment
 export DEBIAN_FRONTEND=noninteractive
 export LANG=C.UTF-8 LC_ALL=C.UTF-8
 export PATH="/usr/local/bin:$PATH"
 export PYTHONUNBUFFERED=1

%files
  ./benchmarks/requirements.txt /requirements.txt

%post
  export DEBIAN_FRONTEND=noninteractive
  echo 'tzdata tzdata/Areas select Etc' | debconf-set-selections
  echo 'tzdata tzdata/Zones/Etc select UTC' | debconf-set-selections
  apt-get update
  apt install -y --no-install-recommends \
        binutils-dev \
        bison \
        build-essential \
        cmake \
        flex \
        gdb \
        git \
        libaio-dev \
        libboost-all-dev \
        libbz2-dev \
        libdouble-conversion-dev \
        libdwarf-dev \
        libelf-dev \
        libevent-dev \
        libfast-float-dev \
        libgflags-dev \
        libgoogle-glog-dev \
        libiberty-dev \
        libjemalloc-dev \
        liblz4-dev \
        liblzma-dev \
        libnuma-dev \
        libsnappy-dev \
        libsodium-dev \
        libssl-dev \
        libunwind-dev \
        liburing-dev \
        make \
        pkg-config \
        pv \
        python3 \
        python3-pip \
        wget \
        zlib1g-dev \
        zstd


  apt install -y g++-11 gcc-11
  update-alternatives --install /usr/bin/gcc gcc /usr/bin/gcc-11 100
  update-alternatives --install /usr/bin/g++ g++ /usr/bin/g++-11 100
  update-alternatives --set gcc /usr/bin/gcc-11
  update-alternatives --set g++ /usr/bin/g++-11

  pip3 install --break-system-packages -r /requirements.txt
